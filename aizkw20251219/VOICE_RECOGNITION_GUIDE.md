# 语音识别参考文本功能使用指南

## 功能说明

现在录音功能已升级，支持**自动语音识别**！录音时会自动识别您说的内容，然后让您确认或编辑文本。

## 使用流程

### 步骤 1：开始录音

1. 点击"录音"按钮
2. 开始说话（5-30秒）
3. 系统会**同时进行语音识别**（显示"识别中..."）

### 步骤 2：停止录音

1. 点击"停止录音"按钮
2. 录音结束，识别结果会自动显示

### 步骤 3：确认参考文本

会弹出确认对话框，显示：

- **音频播放器**：可以回听录音内容
- **识别结果**：自动识别的文本（可编辑）
- **操作按钮**：
  - ✅ **确认使用**：使用当前文本
  - 🔄 **重新识别**：重新识别音频
  - ✏️ **手动编辑**：直接编辑文本框
  - ❌ **取消**：取消操作

### 步骤 4：完成设置

确认后，参考音频和文本会自动保存，可以开始语音对话了！

## 功能特点

### ✅ 自动识别
- 录音时实时识别语音内容
- 无需手动输入文本
- 支持中文识别

### ✅ 可编辑
- 识别结果可以手动编辑
- 确保文本与音频内容一致
- 提高克隆质量

### ✅ 可回听
- 可以播放录音确认内容
- 确保文本准确性

### ✅ 容错机制
- 识别失败时支持手动输入
- 识别不准确时可以编辑
- 支持重新识别

## 注意事项

### 浏览器要求
- ✅ Chrome（推荐）
- ✅ Edge
- ✅ Safari
- ❌ Firefox（不支持 Web Speech API）

### 权限要求
- ✅ 允许麦克风权限
- ✅ 允许音频播放权限

### 录音建议
- 📏 **时长**：5-30秒最佳
- 🎤 **环境**：安静环境，减少噪音
- 🔊 **音量**：清晰、适中的音量
- 📝 **内容**：说完整的句子，不要只说单词

## 常见问题

### Q: 识别不准确怎么办？
A: 可以手动编辑文本，或点击"重新识别"重试。

### Q: 识别失败怎么办？
A: 系统会提示手动输入文本，您可以直接在文本框中输入。

### Q: 可以跳过识别直接输入吗？
A: 可以！在确认对话框中直接编辑文本框即可。

### Q: 识别支持哪些语言？
A: 目前支持中文（zh-CN），其他语言需要配置。

## 技术说明

### 识别引擎
- 使用 **Web Speech API**（浏览器内置）
- 无需后端服务
- 实时识别

### 识别流程
1. 录音开始 → 同时启动语音识别
2. 实时识别 → 显示识别结果
3. 录音结束 → 显示确认对话框
4. 用户确认 → 保存参考文本

## 下一步

设置好参考音频和文本后：

1. ✅ 确保 GPT-SoVITS API 已配置（需要 Cloudflare Tunnel）
2. ✅ 点击"语音对话"按钮启用语音模式
3. ✅ 发送消息，AI 会用您的声音回复！

## 配置 GPT-SoVITS API

### 步骤 1：启动 GPT-SoVITS 服务

确保 GPT-SoVITS 在本地运行：
```powershell
cd E:\GPT-SOVITS-v3lora-20250228
runtime\python.exe api_v2.py
```

### 步骤 2：创建 Cloudflare Tunnel

运行启动脚本：
```powershell
cd d:\web3-migration\aizkw20251219
启动GPT-SoVITS-Tunnel.bat
```

或手动运行：
```powershell
D:\Tunnel\cloudflared.exe tunnel --url http://localhost:9880
```

### 步骤 3：更新配置

复制 Tunnel URL（例如：`https://xxx.trycloudflare.com`）

编辑 `src/voiceConfig.ts`：
```typescript
apiBaseUrl: 'https://您的TunnelURL',
```

### 步骤 4：重新构建并部署

```powershell
npm run build
git add .
git commit -m "Update GPT-SoVITS Tunnel URL"
git push origin main
```

## 验证功能

1. ✅ 录音时显示"识别中..."
2. ✅ 录音结束后弹出确认对话框
3. ✅ 可以播放音频回听
4. ✅ 可以编辑识别文本
5. ✅ 确认后参考文本已保存
6. ✅ 启用语音对话模式
7. ✅ AI 回复时播放语音

## 故障排除

### 问题：识别不工作
- 检查浏览器是否支持（Chrome/Edge/Safari）
- 检查麦克风权限是否允许
- 检查网络连接

### 问题：识别结果为空
- 检查是否在说话
- 检查麦克风是否正常工作
- 尝试重新识别或手动输入

### 问题：音频无法播放
- 检查浏览器音频权限
- 检查音频格式（WAV）
- 尝试刷新页面
